<!DOCTYPE html>

<html>
<head>
  <title>app.litcoffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>app.litcoffee</h1>
        

        
      </div>

      
        
        <p>Simple LMI Calculator based on <a href="http://at.hon.gy/Z1pLvI">http://at.hon.gy/Z1pLvI</a>. Is there a better way
to implement this lookup?</p>

        
          <div class='highlight'><pre>LMI =
	lookup: (lvr, loan) -&gt;
		b1 = [<span class="number">0.41</span>, <span class="number">0.61</span>, <span class="number">0.76</span>, <span class="number">0.91</span>, <span class="number">1.22</span>, <span class="number">1.68</span>, <span class="number">1.89</span>, <span class="number">2.10</span>]
		b2 = [<span class="number">0.52</span>, <span class="number">0.78</span>, <span class="number">0.99</span>, <span class="number">1.18</span>, <span class="number">1.60</span>, <span class="number">2.20</span>, <span class="number">2.47</span>, <span class="number">2.74</span>]
		b3 = [<span class="number">0.72</span>, <span class="number">1.01</span>, <span class="number">1.25</span>, <span class="number">1.50</span>, <span class="number">2.02</span>, <span class="number">3.31</span>, <span class="number">3.56</span>, <span class="number">3.76</span>]

		<span class="keyword">if</span> loan &lt;= <span class="number">300000</span>
			band = b1
		<span class="keyword">else</span> <span class="keyword">if</span> loan &lt;= <span class="number">600000</span>
			band = b2
		<span class="keyword">else</span> <span class="keyword">if</span> loan &lt;= <span class="number">1000000</span>
			band = b3

		<span class="keyword">if</span> lvr &gt; <span class="number">0.8</span> <span class="keyword">and</span> lvr &lt; <span class="number">0.82</span>
			index = <span class="number">0</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.84</span>
			index = <span class="number">1</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.86</span>
			index = <span class="number">2</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.88</span>
			index = <span class="number">3</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.9</span>
			index = <span class="number">4</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.92</span>
			index = <span class="number">5</span>
		<span class="keyword">else</span> <span class="keyword">if</span> lvr &lt; <span class="number">0.94</span>
			index = <span class="number">6</span>
		<span class="keyword">else</span>
			index = <span class="number">7</span>

		band[index] / <span class="number">100</span></pre></div>
        
      
        
        <p>Repayment periods</p>

        
          <div class='highlight'><pre>Period =
	Monthly     : <span class="number">12</span>
	Fortnightly : <span class="number">24</span>
	Weekly      : <span class="number">48</span></pre></div>
        
      
        
        <p>Mortgage</p>

        
          <div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Mortgage</span> <span class="keyword">extends</span> <span class="title">Backbone</span>.<span class="title">Model</span></span></pre></div>
        
      
        
        <p>Every mortgage has these variables which can be adjusted.</p>

        
          <div class='highlight'><pre>	defaults:
		interest: <span class="number">5.74</span>
		price:    <span class="number">700000</span>
		deposit:  <span class="number">150459</span>
		duration: <span class="number">30</span></pre></div>
        
      
        
        <p>TODO: The big fat stamp duty!</p>

        
          <div class='highlight'><pre>	stamp_duty: -&gt;
		<span class="number">26990</span></pre></div>
        
      
        
        <p>Loan is calculated based on the price of the property and the initial deposit
put down on the property.</p>

        
          <div class='highlight'><pre>	loan: -&gt;
		<span class="property">@price</span> - <span class="property">@deposit</span></pre></div>
        
      
        
        <p>This is the total monies borrowed from the lender. It is common to add extra
costs such as LMI, fees on top of the loan in order to decrease the intial
LVR.</p>

        
          <div class='highlight'><pre>	borrowing: -&gt;
		<span class="property">@loan</span>() + <span class="property">@lmi</span>() + <span class="property">@fees</span>() + <span class="property">@stamp_duty</span>()</pre></div>
        
      
        
        <p>TODO: Lender&#39;s settlement fee, legal fees, Registration fees, Other lender fees.</p>

        
          <div class='highlight'><pre>	fees: -&gt;
		<span class="number">2469</span></pre></div>
        
      
        
        <p>Loan to Value Ratio (LVR) is calculated based on the loan and the price of the
property.</p>
<p>Note: This value is almost always presented as percentage value.</p>

        
          <div class='highlight'><pre>	lvr: -&gt;
		<span class="property">@loan</span>() / <span class="property">@price</span></pre></div>
        
      
        
        <p>Depending on the LVR, a mortgage may need pay Lenders&#39; Mortgage Insurace. This
value can vary depending on the LVR and the lender</p>

        
          <div class='highlight'><pre>	lmi: -&gt;
		LMI.lookup(<span class="property">@lvr</span>(), <span class="property">@loan</span>()) * <span class="property">@loan</span>()</pre></div>
        
      
        
        <p>Monthly repayments for the mortgage based on above variables:
M = P (i(1 + i)^n) / ((1 + i)^n - 1)</p>

        
          <div class='highlight'><pre>	repayments: () -&gt;
		P = <span class="property">@borrowing</span>()
		i = <span class="property">@interest</span> / Period.Monthly / <span class="number">100</span>
		n = <span class="property">@duration</span> * Period.Monthly
		P * (i * Math.pow((i + <span class="number">1</span>), n)) / (Math.pow((<span class="number">1</span> + i), n) - <span class="number">1</span>)</pre></div>
        
      
        
        <p>Collection of model properties and computed properties. All units are in human
readable format. For example, percentage units will be exported as: 70.10
intead of 0.7010 which are used in calculations.</p>

        
          <div class='highlight'><pre>	toJSON: -&gt;
		_.extend _.clone(<span class="property">@attributes</span>), {
			fees       : <span class="property">@fees</span>()
			loan       : <span class="property">@loan</span>()
			borrowing  : <span class="property">@borrowing</span>()
			lvr        : <span class="property">@lvr</span>() * <span class="number">100</span>
			repayments : <span class="property">@repayments</span>()
			lmi        : <span class="property">@lmi</span>()
			stamp_duty : <span class="property">@stamp_duty</span>()
		}</pre></div>
        
      
        
        <p>Prettified toJSON</p>

        
          <div class='highlight'><pre>	toFormattedJSON: -&gt;
		monies   = [<span class="string">'price'</span>, <span class="string">'deposit'</span>, <span class="string">'stamp_duty'</span>, <span class="string">'fees'</span>, <span class="string">'loan'</span>, <span class="string">'borrowing'</span>, <span class="string">'repayments'</span>, <span class="string">'lmi'</span>]
		decimals = [<span class="string">'lvr'</span>, <span class="string">'interest'</span>]
		json = <span class="property">@toJSON</span>()
		<span class="keyword">for</span> key, value <span class="keyword">of</span> json
			json[key] = accounting.formatMoney value <span class="keyword">if</span> key <span class="keyword">in</span> monies
			json[key] = accounting.formatNumber value <span class="keyword">if</span> key <span class="keyword">in</span> decimals
		json</pre></div>
        
      
        
        <p>Hack to get it working with Tangle</p>

        
          <div class='highlight'><pre>	update: -&gt;


	toString: -&gt;
		JSON.stringify <span class="property">@toJSON</span>()</pre></div>
        
      
        
        <p>A view to let users input their own mortgage variables</p>

        
          <div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">MortgageFormView</span> <span class="keyword">extends</span> <span class="title">Backbone</span>.<span class="title">View</span></span>
	el: <span class="string">'#form'</span>

	template: _.template $(<span class="string">'#__MortgageForm'</span>).html()

	events:
		<span class="string">'touchstart [type=number]'</span>: <span class="string">'registerTouch'</span>
		<span class="string">'touchmove  [type=number]'</span>: <span class="string">'changeProperty'</span>
		<span class="string">'touchend   [type=number]'</span>: <span class="string">'deregisterTouch'</span>

	initialize: -&gt;
		<span class="property">@binder</span> = <span class="keyword">new</span> Backbone.ModelBinder

	render: -&gt;
		<span class="property">@$el</span>.html <span class="property">@template</span> <span class="property">@model</span>.toJSON()
		<span class="property">@binder</span>.bind <span class="property">@model</span>, <span class="property">@el</span>
		@

	registerTouch: (event) -&gt;
		touch = event.originalEvent.touches[<span class="number">0</span>]
		<span class="property">@touch</span> =
			x: touch.pageX
			y: touch.pageY

	changeProperty: (event) -&gt;
		event.preventDefault()
		touch = event.originalEvent.touches[<span class="number">0</span>]
		$target = $ event.target
		property = $target.attr <span class="string">'name'</span>
		step = $target.data <span class="string">'step'</span>
		value = <span class="property">@model</span>.get property

		<span class="keyword">if</span> (touch.pageY - <span class="property">@touch</span>.y &lt; <span class="number">0</span>)
			value += step
		<span class="keyword">else</span>
			value -= step

		<span class="property">@model</span>.set property, value

	deregisterTouch: (event) -&gt;
		<span class="property">@touch</span> = <span class="literal">null</span>

<span class="class"><span class="keyword">class</span> <span class="title">MortgageSummaryView</span> <span class="keyword">extends</span> <span class="title">Backbone</span>.<span class="title">View</span></span>
	el: <span class="string">'#summary'</span>

	template: _.template $(<span class="string">'#__MortgageSummary'</span>).html()

	initialize: -&gt;
		<span class="property">@listenTo</span> <span class="property">@model</span>, <span class="string">"change"</span>, <span class="property">@render</span>

	render: -&gt;
		<span class="property">@$el</span>.html <span class="property">@template</span> <span class="property">@model</span>.toFormattedJSON()
		@</pre></div>
        
      
        
        <p>Instantiate a default view for everyone as a starting point</p>

        
          <div class='highlight'><pre>m = <span class="keyword">new</span> Mortgage
f = <span class="keyword">new</span> MortgageFormView { model: m }
v = <span class="keyword">new</span> MortgageSummaryView { model: m }

f.render()
v.render()</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
